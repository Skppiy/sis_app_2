{\rtf1\ansi\deff0 Phase A – Attendance: Class Session Sheet (Design Requirements)\par Version: 1.0  • Audience: Product, Engineering, QA • Dependency: Phase A core (users, roles, classes, rosters, calendar blocks), Auth/SSO\par \par 1) Purpose & Scope\par Provide a tablet-friendly, sub-2‑minute flow for teachers (and authorized admins) to take attendance for a specific class block. The screen must default students to Present and support quick changes, reasons, and notes, with full audit, accessibility, and offline tolerance (queued updates). This spec is build‑ready.\par \par 2) Personas & Permissions\par • Teacher (owner of the class): Create/Edit attendance for own class during open window; view history; add notes (internal). \par • Sub/Co‑Teacher (assigned on schedule): Same as Teacher while assigned. \par • Admin (Principal, VP, Dean, Staff): View/Edit any class; retroactive edits with reason. \par • Specialist: Read-only for students in session; can mark separate “Specialist Session Attendance” on their module. \par • Parent/Student: Read-only summary (no internal notes, no staff names).\par \par 3) Success Criteria (SLAs)\par • p50 completion ≤ 2:00 for a 25-student class; p95 ≤ 4:00. \par • Initial screen load ≤ 1.0s p95 on broadband; ≤ 2.5s on school Wi‑Fi. \par • Offline queue posts within 5 minutes of reconnect; conflict resolution surfaced within 10s.\par \par 4) Functional Requirements\par FR‑1 Open Session: When the teacher clicks a calendar block (Today) or navigates from Dashboard→“Take Attendance”, system opens the Class Session Sheet for that block (class_id, block_id, date).\par FR‑2 Defaults: All rostered students default to “Present” until changed; unsaved UI shows a live counter (Present / Absent / Tardy).\par FR‑3 Quick Toggle: Each row supports a single dropdown (Present, Absent–Excused, Absent–Unexcused, Tardy–Excused, Tardy–Unexcused) and an optional Notes icon (popover).\par FR‑4 Bulk Actions: “Mark all Present”, “Clear all”, and bulk mark (Absent/Tardy) for selected students.\par FR‑5 Late Window: After “class start + configurable grace (e.g., 10 min)”, a yellow Late badge suggests Tardy for not‑marked students; teacher can override.\par FR‑6 Save States: “Save” (stay on page), “Save & Close”, and autosave every 30s; keyboard Enter saves current row and moves down.\par FR‑7 Locking: For teachers, edits allowed until end of day; after that, admin override required with reason. All edits are audited.\par FR‑8 Specialist Reconciliation: If a student is marked Present in a Specialist Session overlapping this block and marked Absent here, system flags a reconciliation notice and recommends “Present – Specialist Session” (admin view only).\par FR‑9 Search/Filter: Student instant search; filter by status (All/Absent/Tardy/Notes). \par FR‑10 Accessibility: Full keyboard flow (Arrow keys to move rows, Space toggles dropdown, N opens notes). Screen reader labels for status and row position (e.g., “3 of 25”). \par FR‑11 Export/Print: Admin-only quick export (CSV/PDF) with header metadata (school, class, teacher, date, block). \par FR‑12 Error Handling: Graceful retries for flaky network; red inline error for rows that failed to save; per-row retry. \par FR‑13 Audit: Every create/update stores (who, when, IP/UA, prior→new status, reason if admin/after lock). Retain ≥ 3 years.\par FR‑14 Time Zone: School‑level US time zones only (America/New_York, America/Chicago, America/Denver, America/Los_Angeles, etc.); session timestamps are school‑timezone authoritative.\par FR‑15 Attendance Window: Configurable open/close window per school (e.g., open 15 min before block start; soft close at end of day).\par \par 5) UI/UX Specification\par Layout (Desktop/Tablet):\par • Header: School name • Class (e.g., “Ms. Wilson – 4th Grade – Room 204”) • Date • Block time • Teacher name • “Unsaved changes” indicator • Save / Save & Close (primary), Cancel (secondary).\par • Toolbar (left to right): Search field; Status filter (All/Absent/Tardy/Notes); Bulk actions menu; Legend (color chips: Present=neutral, Absent=red, Tardy=yellow, Excused=blue); Help.\par • Roster Table (virtualized for performance, sticky header):\par   Columns: Student (avatar initials + legal/preferred name + IEP/504 icon if present, tooltip only for teacher/admin), Status (single dropdown), Notes (icon shows popover textarea, 280 chars; “Share with parent” checkbox default OFF), Timestamp (read-only last change), By (read-only last editor role).\par   Row Interactions: Click on Status opens menu; numeric keypad 1=P, 2=AU, 3=AE, 4=TU, 5=TE (configurable hotkeys). \par • Footer: Summary pills (Present/Absent/Tardy); “Marked: 14/25” progress; Lock info; Last autosave timestamp.\par \par Mobile (Portrait):\par • Sticky top bar with class/date and Save. \par • Roster is a two‑line cell: Student name + status chip; tap to open bottom sheet for status + notes.\par • Bulk actions hidden behind “…” menu.\par \par Empty/Edge UI States:\par • No roster: Explain missing enrollments; CTA “Open Roster” (admin/teacher with permission). \par • Class in future: “Attendance opens at 7:50 AM.” Enable “Prepare Notes” only.\par • Class in past (locked): Read-only with “Request Edit” button for teachers (sends to admin queue).\par \par 6) Workflow (Textual Diagram)\par Teacher opens block → System preloads roster + defaults → Teacher scans and marks deviations → Optional notes → Save (autosave in background) → If conflict with Specialist/office passes, show reconciliation banner (admin only) → After end of day, sheet locks; further edits require admin reason.\par \par 7) Business Rules\par BR‑1 Default Present applies only within open window; outside the window, defaults to blank until teacher loads page (prevents silent present after the day closes).\par BR‑2 Note visibility: Notes are internal unless “Share with parent” is ticked. Sensitive keywords (“medical”, “IEP”, “discipline”) trigger a confirm modal reminding privacy scope.\par BR‑3 Tardy Minutes: Optional numeric field if school enables “minutes late”; stored separately for analytics.\par BR‑4 Attendance categories are school‑configurable but must map to canonical states for analytics (Present, Absent, Tardy) with excused flags.\par \par 8) Data Model (Proposed)\par attendance_records\par   • id (uuid, pk)\par   • school_id (uuid, fk schools)\par   • class_id (uuid, fk classes)\par   • calendar_block_id (uuid, fk calendar_blocks)\par   • student_id (uuid, fk students)\par   • status (enum: PRESENT, ABSENT_EXCUSED, ABSENT_UNEXCUSED, TARDY_EXCUSED, TARDY_UNEXCUSED)\par   • minutes_late (int, nullable)\par   • note_internal (text, nullable)\par   • note_shareable (text, nullable)\par   • shared_with_parent (bool, default false)\par   • recorded_at (timestamptz, school tz)\par   • recorded_by (uuid, fk users)\par   • edited_reason (text, nullable)  # required when admin edits after lock\par   • source (enum: TEACHER_UI, ADMIN_UI, IMPORT, OFFLINE_QUEUE, API)\par   • created_at, updated_at (timestamptz)\par   Indexes: (class_id, calendar_block_id), (student_id, recorded_at desc), (status), (school_id, recorded_at)\par \par 9) API Contracts (Design-Ready)\par Auth: Bearer JWT; role claims include role, school_id, teacher_of:[class_ids]. All endpoints scoped to school_id.\par \par GET /api/v1/classes/\{class_id\}/attendance?block_id=\{block_id\}\par   200: \{ class, block, timezone, open_window:\{start,end\}, locked:boolean, roster:[\par     \{ student_id, name, avatar, status, minutes_late, note_shareable, last_change:\{at, by_role\} \}\par   ]\}\par \par PATCH /api/v1/attendance/bulk\par   Body: \{ class_id, block_id, changes:[ \{student_id, status, minutes_late?, note_shareable?, note_internal?\} ], client_ts \}\par   207 Multi-Status: success:[student_id...], errors:[\{student_id, code, message\}]\par \par POST /api/v1/attendance/\{record_id\}/note\par   Body: \{ note_internal?, note_shareable?, shared_with_parent? \}\par   200: \{ record_id, note_shareable, shared_with_parent \}\par \par POST /api/v1/attendance/\{record_id\}/admin-override\par   Body: \{ new_status, edited_reason \}\par   200: updated record; Audit entry created\par \par 409 Codes:\par   • ATTENDANCE_LOCKED\par   • OUTSIDE_OPEN_WINDOW\par   • PERMISSION_DENIED\par   • SPECIALIST_CONFLICT (admin-only informational)\par \par 10) Security & Privacy\par • FERPA: Minimize PII in payloads; mask sensitive flags in parent views. \par • Row-Level Security: Users can only access classes they teach or administer. \par • Field-Level: Hide internal notes from parents/students. \par • Audit: Immutable append-only audit_log table (record_id, actor_id, before, after, reason, timestamp).\par \par 11) Accessibility (WCAG 2.1 AA)\par • Focus indicators, 4.5:1 contrast minimum on chips and buttons. \par • ARIA labels for status controls; announce row/position. \par • Full keyboard ops; skip-to-content link; error messages bound to fields via aria-describedby.\par \par 12) Performance & Offline\par • Virtualized list for >50 students; lazy-load avatars. \par • Request coalescing for rapid edits (debounce 300ms, bulk PATCH). \par • Offline: local queue with idempotency keys; retries with exponential backoff; conflict banner if server state newer.\par \par 13) Telemetry & Metrics\par • Time-to-complete per class; average edits per student; % classes submitted before bell+10; error rate. \par • Funnel: open → first change → save → close; drop-off analysis. \par • Alert on p95 > 4 min or error rate > 1% per day.\par \par 14) QA Acceptance Tests (High Level)\par • Can mark 25-student class in ≤ 2 minutes on iPad. \par • Autosave persists power-loss mid-class. \par • Lock prevents teacher edits next day; admin override requires reason and is audited. \par • Specialist conflict flag appears when overlapping “Present – Specialist Session” exists.\par \par 15) Open Questions\par • School-level policy for default tardy grace period? \par • Should “minutes late” be required when Tardy is selected? \par • Districts with rotating blocks: show block label or exact time by default?\par \par Appendix A – UI Annotations (Textual)\par • Status dropdown items must include icon + color chip for rapid recognition. \par • Notes popover opens aligned to row; escape closes without saving; Cmd/Ctrl+Enter saves. \par • Bulk menu includes “Select none / Select all absent / Select all tardy” shortcuts.\par \par Appendix B – Example Payloads\par PATCH /attendance/bulk\par \{\par   "class_id": "f1a6…",\par   "block_id": "b209…",\par   "changes": [\par     \{"student_id":"s001","status":"ABSENT_UNEXCUSED","note_shareable":"Parent called, will send note."\},\par     \{"student_id":"s002","status":"TARDY_EXCUSED","minutes_late":7\}\par   ],\par   "client_ts": "2025-08-08T08:11:22-04:00"\par \}\par \par Appendix C – Error Messages (User-Facing)\par • “Attendance is locked for this class. Request an admin override to make changes.” \par • “You’re outside today’s attendance window. Try an admin override or come back during class time.” \par • “Network issue—your changes are saved locally and will sync when you’re back online.”}